<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#f4a63a" />
  <title>çˆ¬å±±ç†Šãƒ»ç™¾å²³</title>

  <!-- <link rel="manifest" href="./manifest.webmanifest"> -->

  <link rel="icon" type="image/png" sizes="192x192" href="icons/hiking_bear_icon_192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/hiking_bear_icon_512.png" />
  <link rel="apple-touch-icon" href="icons/hiking_bear_icon_1024.png" />

  <style>
    :root{
      --bg: #ffeec9;
      --wrap: #fff4da;
      --card: #fff7e6;
      --border: #f2c48b;
      --shadow: rgba(0,0,0,.12);
      --text: #4b3044;
      --muted: #7a5b6a;
      --accent: #f4a63a;
      --accent2:#ff6b6b;
      --btn:#ffe0a8;
      --btn2:#ffd1d1;
      --btn3:#d9f3ff;
    }

    html,body{height:100%}
    body{
      margin:0;
      background: var(--bg);
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, "PingFang TC", "Microsoft JhengHei", sans-serif;
      color: var(--text);
    }
    .app{
      max-width: 480px;
      min-height: 100vh;
      margin: 0 auto;
      padding: 10px 12px 16px;
      box-sizing: border-box;
      background: var(--wrap);
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px 6px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(244,166,58,.25), rgba(255,255,255,0));
      border: 2px solid rgba(242,196,139,.6);
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .avatar{
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,.08);
      overflow:hidden;
      flex: 0 0 auto;
      position: relative;
      cursor: pointer;
      padding: 0;
    }
    .avatar img{
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(1.05);
      display:block;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .title h1{
      margin:0;
      font-size: 16px;
      line-height: 1.2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .title .sub{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 8px 10px;
      border-radius: 999px;
      background: #fff;
      border: 2px solid var(--border);
      box-shadow: 0 4px 10px rgba(0,0,0,.06);
      font-size: 12px;
      color: var(--muted);
      user-select:none;
      white-space:nowrap;
    }

    .bubble{
      position: relative;
      background: #fff;
      border: 2px solid var(--border);
      border-radius: 18px;
      padding: 10px 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
      line-height: 1.5;
      font-size: 13px;
    }
    .bubble:before{
      content:"";
      position:absolute;
      left: 18px;
      top: -10px;
      width: 18px;
      height: 18px;
      background:#fff;
      border-left: 2px solid var(--border);
      border-top: 2px solid var(--border);
      transform: rotate(45deg);
    }
    .bubble .hint{
      margin-top:6px;
      font-size: 11px;
      color: var(--muted);
    }

    .card{
      background: var(--card);
      border-radius: 18px;
      border: 2px solid var(--border);
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
      padding: 12px;
    }

    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .section-title h2{
      margin:0;
      font-size: 14px;
    }
    .section-title span{
      font-size: 12px;
      color: var(--muted);
    }

    .btns{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .btn{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      width:100%;
      padding: 12px 12px;
      border-radius: 16px;
      border: 2px solid rgba(242,196,139,.9);
      background: #fff;
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
      cursor:pointer;
      text-align:left;
      transition: transform .06s ease, opacity .2s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.995); }
    .btn[disabled]{ opacity:.55; cursor:not-allowed; }

    .btn .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .ico{
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 20px;
      border: 2px solid rgba(0,0,0,.06);
      flex: 0 0 auto;
    }
    .btn .txt{ min-width:0; }
    .btn .txt b{
      display:block;
      font-size: 14px;
      margin-bottom:2px;
    }
    .btn .txt small{
      display:block;
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .arrow{
      font-size: 18px;
      color: rgba(75,48,68,.55);
      flex: 0 0 auto;
    }

    .btn.beginner .ico{ background: var(--btn); }
    .btn.intermediate .ico{ background: var(--btn3); }
    .btn.advanced .ico{ background: var(--btn2); }

    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal{
      width: min(480px, 100%);
      background: #fff;
      border-radius: 20px;
      border: 2px solid var(--border);
      box-shadow: 0 14px 40px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      background: linear-gradient(180deg, rgba(244,166,58,.22), rgba(255,255,255,0));
      border-bottom: 1px dashed rgba(242,196,139,.9);
    }
    .modal-head b{ font-size: 14px; }
    .close{
      border:none;
      background:#fff;
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 6px 10px;
      cursor:pointer;
      font-size: 12px;
      color: var(--muted);
    }

    .modal-body{ padding: 12px; }
    .m-card{
      background: var(--card);
      border: 2px solid rgba(242,196,139,.9);
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
      padding: 12px;
      line-height: 1.6;
      font-size: 13px;
    }
    .m-title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .m-title h3{
      margin:0;
      font-size: 15px;
      line-height:1.2;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      background:#fff;
      border: 2px solid rgba(0,0,0,.06);
      color: var(--muted);
      white-space:nowrap;
    }
    .bearline{
      margin-top:10px;
      padding-top:10px;
      border-top: 1px dashed rgba(242,196,139,.95);
    }
    .footer-safe{
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
      background: rgba(244,166,58,.12);
      border: 1px dashed rgba(244,166,58,.55);
      padding: 8px 10px;
      border-radius: 14px;
    }
    .bottom-note{
      margin-top:auto;
      text-align:center;
      font-size: 11px;
      color: var(--muted);
      padding: 6px 2px 2px;
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <button class="avatar" id="bearBtn" aria-label="é»æˆ‘è½ç†Šç†Šå°èªï¼ˆå¯é•·æŒ‰è¤‡è£½ï¼‰" title="é»æˆ‘è½ç†Šç†Šå°èªï¼ˆå¯é•·æŒ‰è¤‡è£½ï¼‰">
          <!-- âœ… ä¿®æ­£ï¼šè·¯å¾‘çµ±ä¸€æŒ‡å‘ icons/ -->
          <img src="icons/hiking_bear_icon_1024.png" alt="çˆ¬å±±ç†Š" />
        </button>
        <div class="title">
          <h1>çˆ¬å±±ç†Šãƒ»ç™¾å²³æŠ½å¡</h1>
          <div class="sub">é¸é›£åº¦ â†’ æŠ½ä¸€åº§å±± â†’ çœ‹åˆ°ç†Šç†Šæé†’</div>
        </div>
      </div>
      <div class="pill" id="statusPill">â›°ï¸ è¼‰å…¥ä¸­â€¦</div>
    </header>

    <div class="bubble" id="bubble">
      ğŸ» ç†Šç†Šèªªï¼šé»ä¸€ä¸‹æˆ‘çš„é ­åƒï¼Œæˆ‘æœƒè·Ÿä½ èªªä¸€å¥å‡ºç™¼å°èªï½
      <div class="hint">æç¤ºï¼šé•·æŒ‰å¯è¤‡è£½å°èª</div>
    </div>

    <section class="card">
      <div class="section-title">
        <h2>ä»Šå¤©æƒ³æŒ‘æˆ°å“ªç¨®è·¯ç·šï¼Ÿ</h2>
        <span>ï¼ˆå…ˆåšæŠ½å¡ï¼Œè³‡æ–™å¯æ“´å……åˆ° 100 åº§ï¼‰</span>
      </div>

      <div class="btns">
        <button class="btn beginner" id="btnBeginner" disabled>
          <div class="left">
            <div class="ico">ğŸ’</div>
            <div class="txt">
              <b>æ–°æ‰‹ç™¾å²³</b>
              <small>æ…¢æ…¢èµ°ä¹Ÿå¾ˆæ£’ï¼ˆæ›´è¦ªæ°‘ã€é¢¨éšªç›¸å°å¯æ§ï¼‰</small>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </button>

        <button class="btn intermediate" id="btnIntermediate" disabled>
          <div class="left">
            <div class="ico">ğŸ¥¾</div>
            <div class="txt">
              <b>é€²éšæŒ‘æˆ°</b>
              <small>éœ€è¦é«”èƒ½èˆ‡æº–å‚™ï¼ˆè·¯ç·šæ›´é•·ã€è®ŠåŒ–æ›´å¤§ï¼‰</small>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </button>

        <button class="btn advanced" id="btnAdvanced" disabled>
          <div class="left">
            <div class="ico">âš ï¸</div>
            <div class="txt">
              <b>ç†Šç†Šæé†’ï¼šéœ€å¸¶éšŠ</b>
              <small>æ›éšªæˆ–è¿·é€”é¢¨éšªæ›´é«˜ï¼ˆå»ºè­°è·Ÿç†Ÿè·¯è€…ï¼‰</small>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </button>
      </div>
    </section>

    <div class="bottom-note">
      ğŸ§¡ å®‰å…¨ç¬¬ä¸€ï¼šå¤©æ°£ä¸å¥½å°±æ”¹æœŸï¼›èƒ½å¹³å®‰å›å®¶æ‰æ˜¯æœ€æ£’çš„å†’éšªã€‚
    </div>
  </div>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modal-head">
        <b id="modalHeadTitle">çˆ¬å±±ç†ŠæŠ½åˆ°çš„å±±</b>
        <button class="close" id="closeModal">é—œé–‰</button>
      </div>
      <div class="modal-body">
        <div class="m-card" id="resultCard"></div>
        <div class="footer-safe">
          âš ï¸ å®‰å…¨æé†’ï¼šé«˜å±±ç—‡ã€ä½æº«å¤±æº«ã€åˆå¾Œé›·é™£é›¨ã€æ¿ƒéœ§è¿·é€”éƒ½å¾ˆå¸¸è¦‹ã€‚è«‹ä¾å¤©å€™èˆ‡è‡ªèº«ç‹€æ³èª¿æ•´æˆ–æ’¤é€€ã€‚
        </div>
      </div>
    </div>
  </div>

<script>
  // ========= DOM =========
  const statusPill = document.getElementById("statusPill");
  const bubble = document.getElementById("bubble");
  const bearBtn = document.getElementById("bearBtn");

  const btnBeginner = document.getElementById("btnBeginner");
  const btnIntermediate = document.getElementById("btnIntermediate");
  const btnAdvanced = document.getElementById("btnAdvanced");

  const modalBackdrop = document.getElementById("modalBackdrop");
  const closeModal = document.getElementById("closeModal");
  const resultCard = document.getElementById("resultCard");
  const modalHeadTitle = document.getElementById("modalHeadTitle");

  function setStatus(text){ if(statusPill) statusPill.textContent = text; }

  function enableButtons(enable){
    [btnBeginner, btnIntermediate, btnAdvanced].forEach(b=>{
      if(!b) return;
      b.disabled = !enable;
    });
  }

  // ========= ç†Šç†Šå°èªï¼ˆé»é ­åƒæ›ä¸€å¥ï¼›é•·æŒ‰å¯è¤‡è£½ bubble å…§å®¹ï¼‰=========
  const BEAR_LINES = [
    "ğŸ» ç†Šç†Šèªªï¼šä½ ä¸ç”¨å¾ˆå²å®³æ‰é–‹å§‹ï¼Œä½ é–‹å§‹äº†å°±æœƒè¶Šä¾†è¶Šå²å®³ã€‚",
    "ğŸ» ç†Šç†Šèªªï¼šä»Šå¤©æŠŠå®‰å…¨æ”¾ç¬¬ä¸€åï¼Œä½ å°±å·²ç¶“æ˜¯é«˜æ‰‹äº†ã€‚",
    "ğŸ» ç†Šç†Šèªªï¼šæ…¢æ…¢èµ°ã€å¥½å¥½å‘¼å¸ï¼Œé¢¨æ™¯æœƒåœ¨å‰æ–¹ç­‰ä½ ã€‚",
    "ğŸ» ç†Šç†Šèªªï¼šç™»å±±ä¸æ˜¯æ¯”å¿«ï¼Œæ˜¯æ¯”èª°æ›´æœƒç…§é¡§è‡ªå·±ã€‚",
    "ğŸ» ç†Šç†Šèªªï¼šå¦‚æœå¤©æ°£ä¸å¥½ï¼Œæ”¹æœŸä¹Ÿæ˜¯ä¸€ç¨®å‹‡æ•¢ã€‚"
  ];
  let bearLineIdx = 0;
  function nextBearLine(){
    bearLineIdx = (bearLineIdx + 1) % BEAR_LINES.length;
    bubble.innerHTML = `${BEAR_LINES[bearLineIdx]}<div class="hint">æç¤ºï¼šé•·æŒ‰å¯è¤‡è£½å°èª</div>`;
  }
  bearBtn?.addEventListener("click", nextBearLine);

  // é•·æŒ‰è¤‡è£½
  let pressTimer = null;
  function copyBubble(){
    const text = bubble?.innerText?.trim() || "";
    if(!text) return;
    navigator.clipboard?.writeText(text).then(()=>{
      setStatus("âœ… å·²è¤‡è£½ç†Šç†Šå°èª");
      setTimeout(()=>setStatus("â›°ï¸ ä»Šæ—¥ç‹€æ…‹ï¼šæº–å‚™å‡ºç™¼"), 1200);
    }).catch(()=>{});
  }
  bearBtn?.addEventListener("touchstart", ()=>{ pressTimer = setTimeout(copyBubble, 550); }, {passive:true});
  bearBtn?.addEventListener("touchend", ()=>{ if(pressTimer) clearTimeout(pressTimer); pressTimer=null; });
  bearBtn?.addEventListener("mousedown", ()=>{ pressTimer = setTimeout(copyBubble, 550); });
  bearBtn?.addEventListener("mouseup", ()=>{ if(pressTimer) clearTimeout(pressTimer); pressTimer=null; });

  // ========= Modal =========
  function openModal(){ modalBackdrop.style.display="flex"; modalBackdrop.setAttribute("aria-hidden","false"); }
  function hideModal(){ modalBackdrop.style.display="none"; modalBackdrop.setAttribute("aria-hidden","true"); }

  closeModal?.addEventListener("click", hideModal);
  modalBackdrop?.addEventListener("click", (e)=>{ if(e.target === modalBackdrop) hideModal(); });

  // ========= è®€å– mountains.rich.jsonï¼ˆå«å®¹éŒ¯ï¼‰=========
  let mountains = [];
  let mountainsRich = [];

  async function loadMountains() {
    try{
      setStatus("â›°ï¸ è¼‰å…¥ç™¾å²³è³‡æ–™ä¸­â€¦");
      enableButtons(false);

      const res = await fetch("./mountains.rich.json", { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();

      mountains = Array.isArray(data) ? data : (data.mountains || []);
      mountainsRich = mountains.map(enrichMountain);

      if(!mountainsRich.length) throw new Error("è³‡æ–™ç‚ºç©ºï¼ˆmountainsRich.length=0ï¼‰");

      setStatus("â›°ï¸ ä»Šæ—¥ç‹€æ…‹ï¼šæº–å‚™å‡ºç™¼");
      enableButtons(true);
      console.log("ç™¾å²³è¼‰å…¥å®Œæˆï¼š", mountainsRich.length);
    }catch(err){
      console.error("è¼‰å…¥ç™¾å²³å¤±æ•—ï¼š", err);
      setStatus("âŒ ç™¾å²³è³‡æ–™è¼‰å…¥å¤±æ•—");
      enableButtons(true); // è®“æŒ‰éˆ•é‚„èƒ½æŒ‰ï¼Œä½†æœƒæç¤ºæ± æ²’è³‡æ–™
      bubble.innerHTML = `ğŸ» ç†Šç†Šèªªï¼šæˆ‘æ²’æœ‰æ‰¾åˆ° mountains.rich.jsonã€‚<br>è«‹ç¢ºèªæª”æ¡ˆè·¯å¾‘èˆ‡åç¨±æ­£ç¢ºã€‚<div class="hint">æç¤ºï¼šæŠŠ JSON æ”¾åœ¨åŒå±¤ï¼Œæª”åè¦ä¸€æ¨¡ä¸€æ¨£ã€‚</div>`;
    }
  }

  // ========= é›£åº¦è¦å‰‡ =========
  const FORCE_ADVANCED = new Set([
    "ä¸­å¤®å°–å±±", "å—æ¹–å¤§å±±", "å—æ¹–å¤§å±±æ±å³°", "å—æ¹–å¤§å±±å—å³°", "å—æ¹–åŒ—å±±",
    "å¤§åŠå±±", "å¤§éœ¸å°–å±±", "å°éœ¸å°–å±±", "å“ç”°å±±", "åŠå±±", "ç„¡æ˜å±±"
  ]);

  const FORCE_BEGINNER = new Set([
    "çŸ³é–€å±±", "åˆæ­¡å±±ä¸»å³°", "åˆæ­¡å±±æ±å³°", "åˆæ­¡å±±åŒ—å³°", "è¥¿åˆæ­¡å±±"
  ]);

  function inferDifficulty(m) {
    const name = (m.name_zh || "").trim();
    const elev = Number(m.elevation_m || 0);

    if (FORCE_BEGINNER.has(name)) return "beginner";
    if (FORCE_ADVANCED.has(name)) return "advanced";

    if (elev >= 3600) return "advanced";
    if (elev >= 3300) return "intermediate";
    return "beginner";
  }

  // ========= ç†Šç†Šæ•…äº‹è‡ªå‹•ç”Ÿæˆ =========
  function hashToIndex(num, mod) {
    return Math.abs((num * 2654435761) % 4294967296) % mod;
  }

  const STORY_TPL = {
    beginner: [
      (m)=>`ğŸ» ç†Šç†Šèªªï¼š${m.name_zh}åƒæ˜¯ã€Œç¬¬ä¸€æ­¥ã€â€”â€”æ…¢æ…¢èµ°ï¼Œä¹Ÿæ˜¯åœ¨è®Šå¼·ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šä»Šå¤©é¸${m.name_zh}å¾ˆæ£’ï¼ä½ åœ¨ç·´çš„ä¸æ˜¯é€Ÿåº¦ï¼Œæ˜¯ã€Œç©©å®šã€ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šç«™åœ¨${m.name_zh}çœ‹é¢¨æ™¯ï¼Œè¨˜å¾—ä¹Ÿçœ‹çœ‹è‡ªå·±ï¼šä½ æ­£åœ¨å‰é€²ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šåˆ¥æ€¥ï¼Œå…ˆæŠŠå‘¼å¸æ‰¾å›ä¾†ã€‚${m.name_zh}æœƒé™ªä½ ç·´è€å¿ƒã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šä½ é¡˜æ„å‡ºé–€ï¼Œå°±å·²ç¶“è´ä¸€åŠäº†ã€‚${m.name_zh}æ˜¯æº«æŸ”çš„é–‹å§‹ã€‚`
    ],
    intermediate: [
      (m)=>`ğŸ» ç†Šç†Šèªªï¼š${m.name_zh}æé†’ä½ â€”â€”æº–å‚™ï¼Œæ˜¯æŠŠå¤¢æƒ³èµ°å¾—æ›´å®‰å…¨çš„æ–¹å¼ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šé€™åº§å±±æœƒç´¯ï¼Œä½†ç´¯ä¸æ˜¯å£äº‹ï¼Œå®ƒæ˜¯åœ¨å¹«ä½ æ‰“é–‹æ–°çš„è¦–é‡ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šèµ°åˆ°ä¸€åŠæƒ³æ”¾æ£„æ™‚ï¼Œå…ˆå–æ°´ã€è£œèƒ½é‡ï¼Œå†åšæ±ºå®šã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼š${m.name_zh}åƒä¸€å€‹å°è€ƒé©—ï¼šé…é€Ÿã€è£œæ°´ã€ä¿æš–ï¼Œç¼ºä¸€ä¸å¯ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šä½ ä¸æ˜¯åœ¨å¾æœå±±ï¼Œä½ æ˜¯åœ¨å­¸æœƒç…§é¡§è‡ªå·±ã€‚`
    ],
    advanced: [
      (m)=>`ğŸ» ç†Šç†Šèªªï¼š${m.name_zh}ä¸æ˜¯ã€Œç¡¬ä¸Šã€çš„å±±ï¼Œæ˜¯ã€Œå°Šé‡ã€çš„å±±ã€‚éœ€è¦å¤¥ä¼´èˆ‡åˆ¤æ–·ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šçœŸæ­£çš„å‹‡æ•¢ï¼Œæ˜¯çŸ¥é“ä»€éº¼æ™‚å€™è©²æ’¤é€€ï¼Œä»€éº¼æ™‚å€™å†ä¾†ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šé«˜é¢¨éšªè·¯ç·šè«‹åˆ¥ç¨è¡Œã€‚æŠŠå®‰å…¨æ”¾ç¬¬ä¸€ï¼Œæ‰æœ‰ä¸‹ä¸€æ¬¡çš„å†’éšªã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šé€™åº§å±±æœƒè€ƒé©—ä½ ï¼šå¤©å€™ã€åœ°å½¢ã€å¿ƒæ…‹ã€‚å…ˆæŠŠæº–å‚™åšæ»¿ã€‚`,
      (m)=>`ğŸ» ç†Šç†Šèªªï¼šä½ ä¸éœ€è¦è­‰æ˜ä»€éº¼ã€‚å¹³å®‰å›ä¾†ï¼Œå°±æ˜¯æ»¿åˆ†ã€‚`
    ]
  };

  const ADVICE_TPL = {
    beginner: [
      ()=>"é˜²æ›¬ï¼‹è£œæ°´ï¼‹è–„å¤–å¥—ã€‚æ…¢æ…¢èµ°ã€å‹¤ä¼‘æ¯ã€‚",
      ()=>"ææ—©å‡ºç™¼é¿äººæ½®ï¼Œå›ç¨‹ä¿ç•™é«”åŠ›åˆ¥æ‘¸é»‘ã€‚",
      ()=>"ç™»å±±æ–æœƒå¾ˆåŠ åˆ†ï¼Œæ­¥ä¼å°ä¸€é»æ›´çœåŠ›ã€‚",
      ()=>"é«˜å±±ç´«å¤–ç·šå¼·ï¼Œå¸½å­/å¢¨é¡/é˜²æ›¬è¦è¨˜å¾—ã€‚",
      ()=>"æŠŠé€Ÿåº¦æ”¾æ…¢ï¼Œä½ æœƒèµ°å¾—æ›´ä¹…ã€æ›´èˆ’æœã€‚"
    ],
    intermediate: [
      ()=>"å…ˆç·´é•·æ™‚é–“æ­¥è¡Œèˆ‡çˆ¬å‡ï¼Œè¡Œå‰ç¡é£½åƒå¥½ã€‚",
      ()=>"é…é€Ÿä¿å®ˆã€è£œæ°´è£œé¹½ï¼Œé¢¨å¤§æ™‚åŠ ä¿æš–å±¤ã€‚",
      ()=>"è‹¥é ­ç—›å™å¿ƒæšˆï¼Œå„ªå…ˆä¼‘æ¯è§€å¯Ÿï¼Œå¿…è¦å°±ä¸‹æ’¤ã€‚",
      ()=>"å¸¶é ­ç‡ˆèˆ‡ä¿æš–ï¼Œå¤©å€™è®ŠåŒ–å¿«è¦ç•™æ’¤é€€æ™‚é–“ã€‚",
      ()=>"åˆ†æ®µå°ç›®æ¨™ï¼šä¸‹ä¸€å€‹è½‰å½ã€ä¸‹ä¸€å€‹æ¨¹å½±ã€ä¸‹ä¸€å£æ°´ã€‚"
    ],
    advanced: [
      ()=>"å»ºè­°è·ŸéšŠ/æœ‰ç¶“é©—è€…åŒè¡Œï¼Œè·¯ç·šåˆ¤è®€èˆ‡æ™‚é–“æ§ç®¡å¾ˆé‡è¦ã€‚",
      ()=>"å¤©å€™ä¸ç©©ç›´æ¥æ”¹æœŸï¼›é¿å…å–®ç¨è¡Œå‹•ï¼Œä¿æŒéšŠä¼å®Œæ•´ã€‚",
      ()=>"æº–å‚™ä¿æš–ã€é˜²é›¨ã€é ­ç‡ˆã€æ€¥æ•‘èˆ‡å‚™ç³§ï¼Œä¸¦ç¢ºå¯¦å›å ±è¡Œç¨‹ã€‚",
      ()=>"ç•™è¶³æ’¤é€€æ™‚é–“èˆ‡é«”åŠ›ï¼Œåˆ¥æŠŠã€ç™»é ‚ã€ç•¶æˆå”¯ä¸€ç›®æ¨™ã€‚",
      ()=>"é‡æ¿ƒéœ§/å¼·é¢¨/è½çŸ³é¢¨éšªä¸Šå‡æ™‚ï¼Œå„ªå…ˆæ’¤é€€ä¸çŒ¶è±«ã€‚"
    ]
  };

  function inferRiskNote(diff) {
    if (diff === "beginner") return "âš ï¸ å¤©å€™è®ŠåŒ–å¿«ã€ç´«å¤–ç·šå¼·ï¼›è¨˜å¾—é˜²æ›¬è£œæ°´èˆ‡ä¿æš–ã€‚";
    if (diff === "intermediate") return "âš ï¸ é«˜å±±ç—‡/å¤±æº«/åˆå¾Œé›·é›¨å¸¸è¦‹ï¼›è«‹ä¿ç•™æ’¤é€€æ™‚é–“ã€‚";
    return "âš ï¸ æ›éšª/è¿·é€”/è½çŸ³é¢¨éšªè¼ƒé«˜ï¼›å»ºè­°è·ŸéšŠä¸¦ç¢ºå¯¦åšè¡Œç¨‹æ§ç®¡ã€‚";
  }

  function enrichMountain(m) {
    const diff = inferDifficulty(m);
    const i1 = hashToIndex(m.id || 1, 5);
    const i2 = hashToIndex((m.id || 1) + 7, 5);

    let special = "";
    if ((m.name_zh || "").includes("ç‰å±±")) special = "ï¼ˆå°ç£ä¹‹å·”å®¶æ—ï¼‰";
    if ((m.name_zh || "") === "é›ªå±±") special = "ï¼ˆé»‘æ£®æ—èˆ‡åœˆè°·çš„å‚³èªªï¼‰";

    return {
      ...m,
      difficulty: diff,
      bear_story: STORY_TPL[diff][i1]({ ...m, special }),
      bear_advice: "âœ… " + ADVICE_TPL[diff][i2](),
      risk_note: inferRiskNote(diff)
    };
  }

  // ========= æŠ½å¡ =========
  function pickByDifficulty(diff) {
    const pool = mountainsRich.filter(x => x.difficulty === diff);
    if (!pool.length) return null;
    return pool[Math.floor(Math.random() * pool.length)];
  }

  const diffLabel = { beginner:"æ–°æ‰‹å‹å–„", intermediate:"éœ€è¦ç¶“é©—", advanced:"å»ºè­°å¸¶éšŠ" };

  function renderMountain(m){
    modalHeadTitle.textContent = `æŠ½åˆ°ï¼š${m.name_zh}`;
    resultCard.innerHTML = `
      <div class="m-title">
        <div>
          <h3>${m.name_zh}</h3>
          <div style="margin-top:6px;color:#7a5b6a;font-size:12px;">
            â€¢ ${(m.name_en || "").trim()} <br>
            â€¢ æµ·æ‹” ${m.elevation_m} m
          </div>
        </div>
        <div class="tag">â›°ï¸ ${diffLabel[m.difficulty]}</div>
      </div>

      <div class="bearline">
        <div style="font-weight:700;margin-bottom:6px;">çˆ¬å±±ç†Šæ•…äº‹</div>
        <div>${m.bear_story}</div>

        <div style="font-weight:700;margin:10px 0 6px;">ç†Šç†Šå»ºè­°</div>
        <div>${m.bear_advice}</div>

        <div style="font-weight:700;margin:10px 0 6px;">é¢¨éšªæé†’</div>
        <div>${m.risk_note}</div>
      </div>
    `;
  }

  btnBeginner?.addEventListener("click", ()=>{
    const m = pickByDifficulty("beginner");
    if (!m) return alert("æ–°æ‰‹ç™¾å²³æ± ç›®å‰æ²’æœ‰è³‡æ–™ï¼ˆå¯èƒ½ JSON æœªè¼‰å…¥æˆ–è³‡æ–™æœªåˆ†é¡ï¼‰");
    renderMountain(m); openModal();
  });

  btnIntermediate?.addEventListener("click", ()=>{
    const m = pickByDifficulty("intermediate");
    if (!m) return alert("é€²éšæŒ‘æˆ°æ± ç›®å‰æ²’æœ‰è³‡æ–™ï¼ˆå¯èƒ½ JSON æœªè¼‰å…¥æˆ–è³‡æ–™æœªåˆ†é¡ï¼‰");
    renderMountain(m); openModal();
  });

  btnAdvanced?.addEventListener("click", ()=>{
    const m = pickByDifficulty("advanced");
    if (!m) return alert("éœ€å¸¶éšŠæ± ç›®å‰æ²’æœ‰è³‡æ–™ï¼ˆå¯èƒ½ JSON æœªè¼‰å…¥æˆ–è³‡æ–™æœªåˆ†é¡ï¼‰");
    renderMountain(m); openModal();
  });

  // ========= å•Ÿå‹• =========
  loadMountains();
</script>
</body>
</html>